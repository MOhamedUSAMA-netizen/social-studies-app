// Prisma schema for the social studies app

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id        Int                @id @default(autoincrement())
  name      String             @db.VarChar(255)
  email     String             @unique @db.VarChar(255)
  password  String             @db.VarChar(255)
  modules   Module[]           @relation("UserModules")
  quizzes    QuizAttempt[]      @relation("UserQuizzes")
  lessonProgress LessonProgress[] @relation("UserLessonProgress")
}

model Module {
  id       Int       @id @default(autoincrement())
  title    String    @db.VarChar(255)
  lessons  Lesson[]  @relation("ModuleLessons")
  users    User[]    @relation("UserModules")
}

model Lesson {
  id              Int                @id @default(autoincrement())
  title           String             @db.VarChar(255)
  content         String?
  module          Module             @relation("ModuleLessons", fields: [moduleId], references: [id])
  moduleId        Int
  overrides       LessonOverride[]    @relation("LessonOverrides")
  progress        LessonProgress[]    @relation("LessonProgress")
}

model LessonOverride {
  id       Int              @id @default(autoincrement())
  lesson   Lesson           @relation("LessonOverrides", fields: [lessonId], references: [id])
  lessonId Int
  content  String           @db.Text
}

model Quiz {
  id         Int             @id @default(autoincrement())
  title      String          @db.VarChar(255)
  questions   Question[]      @relation("QuizQuestions")
}

model Question {
  id        Int            @id @default(autoincrement())
  content   String         @db.Text
  quiz      Quiz           @relation("QuizQuestions", fields: [quizId], references: [id])
  quizId    Int
}

model QuizAttempt {
  id        Int               @id @default(autoincrement())
  user      User              @relation("UserQuizzes", fields: [userId], references: [id])
  userId    Int
  quiz      Quiz               @relation(fields: [quizId], references: [id])
  quizId    Int
  score     Float
  date      DateTime         @default(now())
}

model LessonProgress {
  id        Int               @id @default(autoincrement())
  user      User              @relation("UserLessonProgress", fields: [userId], references: [id])
  userId    Int
  lesson    Lesson            @relation(fields: [lessonId], references: [id])
  lessonId  Int
  progress   Float            @default(0)
}